name: Create Branch and Pull Request

on:
  issues:
    types: [opened]

jobs:
  create-branch-and-pull-request:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Extract Issue Information
        id: extract-info
        run: |
          issue_number=${{ github.event.issue.number }}
          issue_title=${{ github.event.issue.title }}
          echo "ISSUE_NUMBER=$issue_number" >> $GITHUB_ENV
          echo "ISSUE_TITLE=$issue_title" >> $GITHUB_ENV

      - name: Create Branch
        run: |
          # Destructure environment variables directly in the command
          branch_name="${ISSUE_NUMBER}_${{ ISSUE_TITLE// /_ }}"
          branch_name=${branch_name//[[:punct:]]/}  # Remove punctuation
          echo "Branch Name: $branch_name"
          git checkout -b "$branch_name"
          git push origin "$branch_name"

      - name: Link Branch to Issue
        run: |
          # Use dedicated action for commenting on issues
          uses: actions/github-script@v6
          with:
            github-token: ${{ secrets.GITHUB_TOKEN }}
            script: |
              const issueNumber = context.issue.number;
              const branchName = `${issueNumber}_${context.issue.title.replace(/\s/g, '_')}`;
              const link = `[here](${context.repo.owner}/${context.repo.repo}/pull/${branchName})`;
              core.issue.createComment({
                issue_number: issueNumber,
                body: `This branch has been created for this issue. You can view the pull request ${link}.`
              });
